name: Claude Docs Review
on:
  pull_request:
    types: [opened, synchronize, ready_for_review, reopened]
    paths:
      - 'data/docs/**'
      - 'public/img/docs/**'
      - 'constants/docsSideNav.ts'
      - 'next.config.js'
      - 'scripts/check-doc-redirects.js'
      - 'scripts/check-docs-metadata.js'
  issue_comment:
    types: [created]

jobs:
  review:
    # Run on PR events as before, or when a new PR comment contains "@claude /review"
    if: >-
      github.event_name == 'pull_request' ||
      (
        github.event_name == 'issue_comment' &&
        github.event.issue.pull_request != null &&
        contains(github.event.comment.body, '@claude /review') &&
        (
          github.event.comment.author_association == 'OWNER' ||
          github.event.comment.author_association == 'MEMBER' ||
          github.event.comment.author_association == 'COLLABORATOR'
        )
      )
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      id-token: write
    steps:
      - uses: actions/checkout@v5
        with:
          fetch-depth: 1

      - uses: anthropics/claude-code-action@v1
        env:
          PR_NUMBER: ${{ github.event.pull_request.number || github.event.issue.number }}
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          track_progress: true # âœ¨ Enables tracking comments
          prompt: |
            REPO: ${{ github.repository }}
            PR NUMBER: ${{ env.PR_NUMBER }}
            Scope: Review only documentation-related changes.
            Source of truth: Use CONTRIBUTING.md at the repo root as the only basis for evaluation.
            Provide concise inline comments for specific issues.
            Do not mention things that are correct. Do not praise or restate compliant items.
            
          claude_args: |
            --allowedTools "mcp__github_inline_comment__create_inline_comment,Bash(gh pr comment:*),Bash(gh pr diff:*),Bash(gh pr view:*),Bash(cat:*)"
